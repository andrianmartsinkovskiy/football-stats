import {PLAYERS} from "../const/players.js";
import {COLORS} from "../const/colors.js";

export const TEST_DATA = [
  {
    player: {...PLAYERS[0]},
    color: {...COLORS[0]},
    stats: [
      {
        cards: {
          yellow: 2,
          yellowred: 1,
          red: 0
        },
        dribbles: {
          attempts: 65,
          success: 34,
          past: null
        },
        duels: {
          total: 190,
          won: 90
        },
        fouls: {
          drawn: 46,
          committed: 12
        },
        games: {
          appearances: 8,
          lineups: 8,
          minutes: 725,
          number: null,
          position: 'Attacker'
        },
        goals: {
          total: 5,
          conceded: 0,
          assists: 3,
          saves: null
        },
        league: {
          id: 2,
          name: 'UEFA Champions League 1',
          country: 'World',
          logo: 'https://media.api-sports.io/football/leagues/2.png'
        },
        passes: {
          total: 370,
          key: 18,
          accuracy: 35
        },
        penalty: {
          won: null,
          committed: null,
          scored: 2,
          missed: 0,
          saved: null
        },
        shots: {
          total: 25,
          on: 18
        },
        substitutes: {
          in: 1,
          out: 4,
          bench: 1
        },
        tackles: {
          total: 6,
          blocks: 1,
          interceptions: 4
        },
        team: {
          id: 85,
          name: 'Paris Saint Germain',
          logo: 'https://media.api-sports.io/football/teams/85.png'
        }
      },
      {
        cards: {
          yellow: 2,
          yellowred: 1,
          red: 0
        },
        dribbles: {
          attempts: 65,
          success: 34,
          past: null
        },
        duels: {
          total: 190,
          won: 90
        },
        fouls: {
          drawn: 46,
          committed: 12
        },
        games: {
          appearances: 8,
          lineups: 8,
          minutes: 725,
          number: null,
          position: 'Attacker'
        },
        goals: {
          total: 5,
          conceded: 0,
          assists: 3,
          saves: null
        },
        league: {
          id: 2,
          name: 'UEFA Champions League 2',
          country: 'World',
          logo: 'https://media.api-sports.io/football/leagues/2.png'
        },
        passes: {
          total: 370,
          key: 18,
          accuracy: 35
        },
        penalty: {
          won: null,
          committed: null,
          scored: 2,
          missed: 0,
          saved: null
        },
        shots: {
          total: 25,
          on: 18
        },
        substitutes: {
          in: 1,
          out: 4,
          bench: 1
        },
        tackles: {
          total: 6,
          blocks: 1,
          interceptions: 4
        },
        team: {
          id: 85,
          name: 'Paris Saint Germain',
          logo: 'https://media.api-sports.io/football/teams/85.png'
        }
      },
      {
        cards: {
          yellow: 2,
          yellowred: 1,
          red: 0
        },
        dribbles: {
          attempts: 65,
          success: 34,
          past: null
        },
        duels: {
          total: 190,
          won: 90
        },
        fouls: {
          drawn: 46,
          committed: 12
        },
        games: {
          appearances: 8,
          lineups: 8,
          minutes: 725,
          number: null,
          position: 'Attacker'
        },
        goals: {
          total: 5,
          conceded: 0,
          assists: 3,
          saves: null
        },
        league: {
          id: 2,
          name: 'UEFA Champions League 3',
          country: 'World',
          logo: 'https://media.api-sports.io/football/leagues/2.png'
        },
        passes: {
          total: 370,
          key: 18,
          accuracy: 35
        },
        penalty: {
          won: null,
          committed: null,
          scored: 2,
          missed: 0,
          saved: null
        },
        shots: {
          total: 25,
          on: 18
        },
        substitutes: {
          in: 1,
          out: 4,
          bench: 1
        },
        tackles: {
          total: 6,
          blocks: 1,
          interceptions: 4
        },
        team: {
          id: 85,
          name: 'Paris Saint Germain',
          logo: 'https://media.api-sports.io/football/teams/85.png'
        }
      }
    ]
  },
  {
    player: {...PLAYERS[1]},
    color: {...COLORS[1]},
    stats: [
      {
        cards: {
          yellow: 2,
          yellowred: 1,
          red: 0
        },
        dribbles: {
          attempts: 65,
          success: 34,
          past: null
        },
        duels: {
          total: 190,
          won: 90
        },
        fouls: {
          drawn: 46,
          committed: 12
        },
        games: {
          appearances: 8,
          lineups: 8,
          minutes: 725,
          number: null,
          position: 'Attacker'
        },
        goals: {
          total: 5,
          conceded: 0,
          assists: 3,
          saves: null
        },
        league: {
          id: 2,
          name: 'UEFA Champions League 1',
          country: 'World',
          logo: 'https://media.api-sports.io/football/leagues/2.png'
        },
        passes: {
          total: 370,
          key: 18,
          accuracy: 35
        },
        penalty: {
          won: null,
          committed: null,
          scored: 2,
          missed: 0,
          saved: null
        },
        shots: {
          total: 25,
          on: 18
        },
        substitutes: {
          in: 1,
          out: 4,
          bench: 1
        },
        tackles: {
          total: 6,
          blocks: 1,
          interceptions: 4
        },
        team: {
          id: 85,
          name: 'Paris Saint Germain',
          logo: 'https://media.api-sports.io/football/teams/85.png'
        }
      },
      {
        cards: {
          yellow: 2,
          yellowred: 1,
          red: 0
        },
        dribbles: {
          attempts: 65,
          success: 34,
          past: null
        },
        duels: {
          total: 190,
          won: 90
        },
        fouls: {
          drawn: 46,
          committed: 12
        },
        games: {
          appearances: 8,
          lineups: 8,
          minutes: 725,
          number: null,
          position: 'Attacker'
        },
        goals: {
          total: 5,
          conceded: 0,
          assists: 3,
          saves: null
        },
        league: {
          id: 2,
          name: 'UEFA Champions League 2',
          country: 'World',
          logo: 'https://media.api-sports.io/football/leagues/2.png'
        },
        passes: {
          total: 370,
          key: 18,
          accuracy: 35
        },
        penalty: {
          won: null,
          committed: null,
          scored: 2,
          missed: 0,
          saved: null
        },
        shots: {
          total: 25,
          on: 18
        },
        substitutes: {
          in: 1,
          out: 4,
          bench: 1
        },
        tackles: {
          total: 6,
          blocks: 1,
          interceptions: 4
        },
        team: {
          id: 85,
          name: 'Paris Saint Germain',
          logo: 'https://media.api-sports.io/football/teams/85.png'
        }
      },
      {
        cards: {
          yellow: 2,
          yellowred: 1,
          red: 0
        },
        dribbles: {
          attempts: 65,
          success: 34,
          past: null
        },
        duels: {
          total: 190,
          won: 90
        },
        fouls: {
          drawn: 46,
          committed: 12
        },
        games: {
          appearances: 8,
          lineups: 8,
          minutes: 725,
          number: null,
          position: 'Attacker'
        },
        goals: {
          total: 5,
          conceded: 0,
          assists: 3,
          saves: null
        },
        league: {
          id: 2,
          name: 'UEFA Champions League 3',
          country: 'World',
          logo: 'https://media.api-sports.io/football/leagues/2.png'
        },
        passes: {
          total: 370,
          key: 18,
          accuracy: 35
        },
        penalty: {
          won: null,
          committed: null,
          scored: 2,
          missed: 0,
          saved: null
        },
        shots: {
          total: 25,
          on: 18
        },
        substitutes: {
          in: 1,
          out: 4,
          bench: 1
        },
        tackles: {
          total: 6,
          blocks: 1,
          interceptions: 4
        },
        team: {
          id: 85,
          name: 'Paris Saint Germain',
          logo: 'https://media.api-sports.io/football/teams/85.png'
        }
      }
    ]
  },
  {
    player: {...PLAYERS[2]},
    color: {...COLORS[2]},
    stats: [
      {
        cards: {
          yellow: 2,
          yellowred: 1,
          red: 0
        },
        dribbles: {
          attempts: 65,
          success: 34,
          past: null
        },
        duels: {
          total: 190,
          won: 90
        },
        fouls: {
          drawn: 46,
          committed: 12
        },
        games: {
          appearances: 8,
          lineups: 8,
          minutes: 725,
          number: null,
          position: 'Attacker'
        },
        goals: {
          total: 5,
          conceded: 0,
          assists: 3,
          saves: null
        },
        league: {
          id: 2,
          name: 'UEFA Champions League 1',
          country: 'World',
          logo: 'https://media.api-sports.io/football/leagues/2.png'
        },
        passes: {
          total: 370,
          key: 18,
          accuracy: 35
        },
        penalty: {
          won: null,
          committed: null,
          scored: 2,
          missed: 0,
          saved: null
        },
        shots: {
          total: 25,
          on: 18
        },
        substitutes: {
          in: 1,
          out: 4,
          bench: 1
        },
        tackles: {
          total: 6,
          blocks: 1,
          interceptions: 4
        },
        team: {
          id: 85,
          name: 'Paris Saint Germain',
          logo: 'https://media.api-sports.io/football/teams/85.png'
        }
      },
      {
        cards: {
          yellow: 2,
          yellowred: 1,
          red: 0
        },
        dribbles: {
          attempts: 65,
          success: 34,
          past: null
        },
        duels: {
          total: 190,
          won: 90
        },
        fouls: {
          drawn: 46,
          committed: 12
        },
        games: {
          appearances: 8,
          lineups: 8,
          minutes: 725,
          number: null,
          position: 'Attacker'
        },
        goals: {
          total: 5,
          conceded: 0,
          assists: 3,
          saves: null
        },
        league: {
          id: 2,
          name: 'UEFA Champions League 2',
          country: 'World',
          logo: 'https://media.api-sports.io/football/leagues/2.png'
        },
        passes: {
          total: 370,
          key: 18,
          accuracy: 35
        },
        penalty: {
          won: null,
          committed: null,
          scored: 2,
          missed: 0,
          saved: null
        },
        shots: {
          total: 25,
          on: 18
        },
        substitutes: {
          in: 1,
          out: 4,
          bench: 1
        },
        tackles: {
          total: 6,
          blocks: 1,
          interceptions: 4
        },
        team: {
          id: 85,
          name: 'Paris Saint Germain',
          logo: 'https://media.api-sports.io/football/teams/85.png'
        }
      },
      {
        cards: {
          yellow: 2,
          yellowred: 1,
          red: 0
        },
        dribbles: {
          attempts: 65,
          success: 34,
          past: null
        },
        duels: {
          total: 190,
          won: 90
        },
        fouls: {
          drawn: 46,
          committed: 12
        },
        games: {
          appearances: 8,
          lineups: 8,
          minutes: 725,
          number: null,
          position: 'Attacker'
        },
        goals: {
          total: 5,
          conceded: 0,
          assists: 3,
          saves: null
        },
        league: {
          id: 2,
          name: 'UEFA Champions League 3',
          country: 'World',
          logo: 'https://media.api-sports.io/football/leagues/2.png'
        },
        passes: {
          total: 370,
          key: 18,
          accuracy: 35
        },
        penalty: {
          won: null,
          committed: null,
          scored: 2,
          missed: 0,
          saved: null
        },
        shots: {
          total: 25,
          on: 18
        },
        substitutes: {
          in: 1,
          out: 4,
          bench: 1
        },
        tackles: {
          total: 6,
          blocks: 1,
          interceptions: 4
        },
        team: {
          id: 85,
          name: 'Paris Saint Germain',
          logo: 'https://media.api-sports.io/football/teams/85.png'
        }
      }
    ]
  },
  {
    player: {...PLAYERS[3]},
    color: {...COLORS[3]},
    stats: [
      {
        cards: {
          yellow: 2,
          yellowred: 1,
          red: 0
        },
        dribbles: {
          attempts: 65,
          success: 34,
          past: null
        },
        duels: {
          total: 190,
          won: 90
        },
        fouls: {
          drawn: 46,
          committed: 12
        },
        games: {
          appearances: 8,
          lineups: 8,
          minutes: 725,
          number: null,
          position: 'Attacker'
        },
        goals: {
          total: 5,
          conceded: 0,
          assists: 3,
          saves: null
        },
        league: {
          id: 2,
          name: 'UEFA Champions League 1',
          country: 'World',
          logo: 'https://media.api-sports.io/football/leagues/2.png'
        },
        passes: {
          total: 370,
          key: 18,
          accuracy: 35
        },
        penalty: {
          won: null,
          committed: null,
          scored: 2,
          missed: 0,
          saved: null
        },
        shots: {
          total: 25,
          on: 18
        },
        substitutes: {
          in: 1,
          out: 4,
          bench: 1
        },
        tackles: {
          total: 6,
          blocks: 1,
          interceptions: 4
        },
        team: {
          id: 85,
          name: 'Paris Saint Germain',
          logo: 'https://media.api-sports.io/football/teams/85.png'
        }
      },
      {
        cards: {
          yellow: 2,
          yellowred: 1,
          red: 0
        },
        dribbles: {
          attempts: 65,
          success: 34,
          past: null
        },
        duels: {
          total: 190,
          won: 90
        },
        fouls: {
          drawn: 46,
          committed: 12
        },
        games: {
          appearances: 8,
          lineups: 8,
          minutes: 725,
          number: null,
          position: 'Attacker'
        },
        goals: {
          total: 5,
          conceded: 0,
          assists: 3,
          saves: null
        },
        league: {
          id: 2,
          name: 'UEFA Champions League 2',
          country: 'World',
          logo: 'https://media.api-sports.io/football/leagues/2.png'
        },
        passes: {
          total: 370,
          key: 18,
          accuracy: 35
        },
        penalty: {
          won: null,
          committed: null,
          scored: 2,
          missed: 0,
          saved: null
        },
        shots: {
          total: 25,
          on: 18
        },
        substitutes: {
          in: 1,
          out: 4,
          bench: 1
        },
        tackles: {
          total: 6,
          blocks: 1,
          interceptions: 4
        },
        team: {
          id: 85,
          name: 'Paris Saint Germain',
          logo: 'https://media.api-sports.io/football/teams/85.png'
        }
      },
      {
        cards: {
          yellow: 2,
          yellowred: 1,
          red: 0
        },
        dribbles: {
          attempts: 65,
          success: 34,
          past: null
        },
        duels: {
          total: 190,
          won: 90
        },
        fouls: {
          drawn: 46,
          committed: 12
        },
        games: {
          appearances: 8,
          lineups: 8,
          minutes: 725,
          number: null,
          position: 'Attacker'
        },
        goals: {
          total: 5,
          conceded: 0,
          assists: 3,
          saves: null
        },
        league: {
          id: 2,
          name: 'UEFA Champions League 3',
          country: 'World',
          logo: 'https://media.api-sports.io/football/leagues/2.png'
        },
        passes: {
          total: 370,
          key: 18,
          accuracy: 35
        },
        penalty: {
          won: null,
          committed: null,
          scored: 2,
          missed: 0,
          saved: null
        },
        shots: {
          total: 25,
          on: 18
        },
        substitutes: {
          in: 1,
          out: 4,
          bench: 1
        },
        tackles: {
          total: 6,
          blocks: 1,
          interceptions: 4
        },
        team: {
          id: 85,
          name: 'Paris Saint Germain',
          logo: 'https://media.api-sports.io/football/teams/85.png'
        }
      }
    ]
  },
]

const mergeStats = (data) => {
  return data.reduce((acc, curr) => {
    for (const key in curr) {
      if (typeof curr[key] === 'object' && !Array.isArray(curr[key])) {
        if (!acc[key]) acc[key] = {};
        for (const subKey in curr[key]) {
          if (typeof curr[key][subKey] === 'number') {
            acc[key][subKey] = (acc[key][subKey] || 0) + curr[key][subKey];
          } else if (acc[key][subKey] === undefined) {
            acc[key][subKey] = curr[key][subKey];
          }
        }
      }
    }
    return acc;
  }, {});
};

function sortByKey(arr, key, order = 'asc') {
  return arr.sort((a, b) => {
    const valA = a[key];
    const valB = b[key];

    if (order === 'asc') {
      return valA - valB;
    } else if (order === 'desc') {
      return valB - valA;
    }

    return 0; // якщо напрямок не вказаний
  });
}

export const transformPlayerStatsHelper = (initData) => {
  const data = initData.map(item => {
    return {
      player: item.player,
      stats: mergeStats(item.stats),
      color: item.color
    }
  })


  // calculate stats
  const effective = data.map((item) => {
    const {stats} = item
    return {
      value: (stats.games.minutes / (stats.goals.total + stats.goals.assists)).toFixed(1),
      player: item.player,
      color: item.color
    }
  })
  const goals = data.map((item) => {
    const {stats} = item
    return {
      value: stats.goals.total,
      player: item.player,
      color: item.color
    }
  })
  const goalsPerMinute = data.map((item) => {
    const {stats} = item
    return {
      value: (stats.games.minutes / stats.goals.total).toFixed(1),
      player: item.player,
      color: item.color
    }
  })
  const goalsPerShoot = data.map((item) => {
    const {stats} = item
    return {
      value: (stats.shots.total / stats.goals.total).toFixed(1),
      player: item.player,
      color: item.color
    }
  })
  const shoots = data.map((item) => {
    const {stats} = item
    return {
      value: stats.shots.total,
      player: item.player,
      color: item.color
    }
  })
  const shootsPerMinutes = data.map((item) => {
    const {stats} = item
    return {
      value: (stats.games.minutes / stats.shots.total).toFixed(1),
      player: item.player,
      color: item.color
    }
  })
  const shootsProc = data.map((item) => {
    const {stats} = item
    return {
      value: (100 / stats.shots.total * stats.shots.on).toFixed(1) ,
      player: item.player,
      color: item.color
    }
  })

  const passes = data.map((item) => {
    const {stats} = item
    return {
      value: stats.passes.total ,
      player: item.player,
      color: item.color
    }
  })

  const passesKey = data.map((item) => {
    const {stats} = item
    return {
      value: stats.passes.key,
      player: item.player,
      color: item.color
    }
  })

  const dribbles = data.map((item) => {
    const {stats} = item
    return {
      value: stats.dribbles.attempts,
      player: item.player,
      color: item.color
    }
  })

  const dribblesSuccess = data.map((item) => {
    const {stats} = item
    return {
      value: stats.dribbles.success,
      player: item.player,
      color: item.color
    }
  })

  const dribblesProc = data.map((item) => {
    const {stats} = item
    return {
      value: (100 / stats.dribbles.attempts * stats.dribbles.success).toFixed(1) ,
      player: item.player,
      color: item.color
    }
  })

  const duels = data.map((item) => {
    const {stats} = item
    return {
      value: stats.duels.total,
      player: item.player,
      color: item.color
    }
  })

  const duelsSuccess = data.map((item) => {
    const {stats} = item
    return {
      value: stats.duels.won,
      player: item.player,
      color: item.color
    }
  })

  const duelsProc = data.map((item) => {
    const {stats} = item
    return {
      value: (100 / stats.duels.total * stats.duels.won).toFixed(1) ,
      player: item.player,
      color: item.color
    }
  })

  const foulsDrawn = data.map((item) => {
    const {stats} = item
    return {
      value: stats.fouls.drawn,
      player: item.player,
      color: item.color
    }
  })

  const foulsCommited = data.map((item) => {
    const {stats} = item
    return {
      value: stats.fouls.committed,
      player: item.player,
      color: item.color
    }
  })

  const yellowCards = data.map((item) => {
    const {stats} = item
    return {
      value: stats.cards.yellow,
      player: item.player,
      color: item.color
    }
  })

  const redCards = data.map((item) => {
    const {stats} = item
    return {
      value: stats.cards.red,
      player: item.player,
      color: item.color
    }
  })

  return {
    effective: sortByKey(effective, "value"),
    goals: sortByKey(goals, "value", "desc"),
    goalsPerMinute: sortByKey(goalsPerMinute, "value"),
    goalsPerShoot: sortByKey(goalsPerShoot, "value"),
    shoots: sortByKey(shoots, "value", "desc"),
    shootsPerMinutes: sortByKey(shootsPerMinutes, "value"),
    shootsProc: sortByKey(shootsProc, "value", "desc"),
    passes: sortByKey(passes, "value", "desc"),
    passesKey: sortByKey(passesKey, "value", "desc"),
    dribbles: sortByKey(dribbles, "value", "desc"),
    dribblesSuccess: sortByKey(dribblesSuccess, "value", "desc"),
    dribblesProc: sortByKey(dribblesProc, "value", "desc"),
    duels: sortByKey(duels, "value", "desc"),
    duelsSuccess: sortByKey(duelsSuccess, "value", "desc"),
    duelsProc: sortByKey(duelsProc, "value", "desc"),
    foulsDrawn: sortByKey(foulsDrawn, "value", "desc"),
    foulsCommited: sortByKey(foulsCommited, "value"),
    yellowCards: sortByKey(yellowCards, "value"),
    redCards: sortByKey(redCards, "value"),
  }
}